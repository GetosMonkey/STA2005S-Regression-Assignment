---
title: "Stats Assignment 1"
author: "Group 48 - ABRMAR043"
format: html
editor: visual
---

# STA2005S Regression Assignment

Setup, Data loading and Objective:

```{r, echo=TRUE, eval=TRUE, include=FALSE}
# We want to analyse the relationships between the variables: (outside_temperature, humidity, wind_speed, household_size, appliance_index, energy_efficiency, solar_installed, day_of_week, and holiday) against consumption_kwh to inform demand-side management and efficiency policy

#| results: hide
#| warning: false
#| message: false
#| error: false
if (!requireNamespace("remotes", quietly = TRUE)) {
install.packages("remotes")
}
remotes::install_github("MiguelRodo/DataTidyRodoSTA2005S")
data("data_tidy_energy_use", package = "DataTidyRodoSTA2005S")

```

```{r}
#| results: hide
#| warning: false
#| echo: false

library(ggplot2)
library(dplyr)
library(tidyr)
library(car)
library(MASS)
library(reshape2)
library(reactable)
library(shiny)

data <- data_tidy_energy_use

consumption_kwh <- data$consumption_kwh
outside_temperature <- data$outside_temperature
humidity <- data$humidity
wind_speed <- data$wind_speed
household_size <- data$household_size
appliance_index <- data$appliance_index

energy_efficiency <- factor(data$energy_efficiency, levels = c("Poor", "Average", "Good", "Excellent"), ordered = TRUE)

solar_installed <- factor(data$solar_installed, levels = c("Yes", "No"), ordered = TRUE)

day_of_week <- factor(data$day_of_week, 
levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"), ordered = TRUE)

holiday <- data$holiday

# Making a color Palette for my document: 
col_palette = c (
  "#ff6fae",
  "#d81159",
  "#f94144", 
  "#f3722c", 
  "#f8961e", 
  "#f9c74f",
  "#90be6d", 
  "#43aa8b",
  "#4d908e",
  "#277da1",
  "#3a86ff",
  "#7766EB",
  "#9d4edd",
  "#991090", 
  "#c93399"
  
)

```
---

## Part One: Analysis

### Section 1: Introduction

#### Problem & Unknown:

```{r}

```

#### Analysis Summary:

```{r}

```

#### Nature of analysis:

```{r}

```

### Section 2: Data Exploration

#### Density Plots:

```{r}
# Plot a histogram of consumption_kwh (freq = FALSE, if using base R) with an overlaid normal density 

mean_kwh <- mean(consumption_kwh, na.rm = TRUE)
sd_kwh <- sd(consumption_kwh, na.rm = TRUE)

hist(consumption_kwh, 
     freq = FALSE, 
     main = "Histogram of Electricity Consumption", 
     xlab = "Consumption (kwh)",
     ylab = "Density",
     col = col_palette[7], 
     border = "white"
     )

curve(dnorm(x, mean = mean_kwh, sd = sd_kwh), 
      col = col_palette[11], 
      lwd = 2.5, 
      add = TRUE
      )

```

```{r}
#| warning: false
# Plot the density of consumption_kwh, stratified by solar_installed, with overlaid normal densities. Comment on the shape, and consider why the densities changes from the unstratified case.

solar_yes <- data %>% filter(solar_installed == "Yes")
solar_no <- data %>% filter(solar_installed == "No")

mean_solar <- mean(solar_yes$consumption_kwh, na.rm = TRUE)
mean_no_solar <- mean(solar_no$consumption_kwh, na.rm = TRUE)
sd_solar <- sd(solar_yes$consumption_kwh, na.rm = TRUE)
sd_no_solar <- sd(solar_no$consumption_kwh, na.rm = TRUE)

ggplot(data, aes(x = consumption_kwh, fill = solar_installed)) +
  geom_density(color = "white", linewidth = 0, alpha = 0.4) +

  stat_function(fun = dnorm, 
                args = list(mean = mean_solar, sd = sd_solar),
                aes(linetype = "Normal (Solar)"),
                color = col_palette[4], linewidth = 1.15) +
  stat_function(fun = dnorm, 
                args = list(mean = mean_no_solar, sd = sd_no_solar),
                aes(linetype = "Normal (No solar)"),
                color = col_palette[12], linewidth = 1.15) +
  
  scale_fill_manual(values= c("Yes"=col_palette[1], "No"=col_palette[11])) +
  scale_linetype_manual(values = c(2, 2), name = "Normal Distribution") +
  
  labs(title = "Density Plot of Electricity Consumption Density by Solar Installation", 
       x = "Consumption (kWh)", 
       y = "Density",
       fill = "Solar Installed"
       ) +
  theme_minimal()
  
```

#### Pairwise Plots:

```{r}
#| fig-width: 22
#| fig-height: 18
#| out-width: "100%"
#| layout-ncol: 1
#| dpi: 150

# Create pairwise scatterplots for all continuous variables, including consumption_kwh

cts_variables <- data %>%
  dplyr::select(consumption_kwh, outside_temperature, humidity, 
                wind_speed, household_size, appliance_index)

day_numeric <- as.numeric(factor(data$day_of_week, 
levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"), ordered = TRUE))

efficiency_numeric <- as.numeric(factor(data$energy_efficiency, levels = c("Poor", "Average", "Good", "Excellent"), ordered = TRUE))

solar_numeric <- as.numeric(factor(data$solar_installed, levels = c("Yes", "No"), ordered = TRUE))
#_________________________________________________________________

# Graph
pairs(x = cts_variables, pch = 19, 
      col = col_palette[efficiency_numeric + 1], 
      main = " Pairwise Scatterplot for Continous Variables", 
      gap = 0.5,
      las = 1, 
      cex = 3, 
      cex.labels = 3, 
      cex.axis = 3,
      cex.main = 3
      )
```

#### Categorical Variable Plots:

```{r}
#| fig-align: "center"

# Plot consumption_kwh against each categorical variable. Namely: Solar_installed, Energy_efficient, days_of_the_week, and holiday

par(mar = c(4, 10, 3, 2))
boxplot(consumption_kwh ~ efficiency_numeric, data = data,
        horizontal = TRUE, 
        names = levels(energy_efficiency),
        xlab = "Energy Consumption (kWh)", ylab = "", 
        main = "Boxplot of Energy Consumption \nby Efficiency",
        col = col_palette[1:4], 
        las = 1
        )
mtext("Efficiency", side = 2, line = 6, cex = 1, font = 1)

par(mar = c(4, 10, 3, 2))
boxplot(consumption_kwh ~ solar_numeric, data = data, 
        horizontal = TRUE,
        names = levels(solar_installed),
        xlab = "Energy Consumption (kWh)", ylab = "Solar Installed", 
        main = "Boxplot of Energy Consumption \nby Solar Use",
        col = col_palette[5:6], 
        las = 1
        )

par(mar = c(4, 10, 3, 2))
boxplot(consumption_kwh ~ day_numeric, data = data, 
        horizontal = TRUE,
        names = levels(day_of_week),
        xlab = "Energy Consumption (kWh)", ylab = "", 
        main = "Boxplot of Energy Consumption \nby Weekday",
        col = col_palette[7:13], 
        las = 1
        )
mtext("Weekday", side = 2, line = 6, cex = 1, font = 1)

par(mar = c(4, 10, 3, 2))
boxplot(consumption_kwh ~ holiday, data = data, 
        horizontal = TRUE,
        names = c("No", "Yes"),
        xlab = "Energy Consumption (kWh)", ylab = "Holiday", 
        main = "Boxplot of Energy Consumption \nby Holiday Status",
        col = col_palette[14:15], 
        las = 1
        )

```

#### Categorical Relationships:

###### Energy Efficiency vs Solar Usage Table:
```{r}
#| echo: false

my_theme <- reactableTheme(
            highlightColor = col_palette[1],
            headerStyle = list(
              background = col_palette[11],
              color = "white",
              fontSize = "14px",
              fontWeight = "bold",
              borderBottom = paste0("2px solid ",col_palette[4])
            )
            )
  
# Efficiency vs Solar Usage

efficiency_solar <- as.data.frame.matrix(table(energy_efficiency, solar_installed))

reactable(efficiency_solar, 
          columns = list( .rownames = colDef(name = "Energy Efficiency"), No = colDef(name = "No Solar"), Yes = colDef(name = "Solar use")),
          sortable = FALSE,
          highlight = TRUE, 
          borderless = TRUE, 
          bordered = TRUE,
          theme = my_theme
          )

```
<br>

###### Weekdays vs Holidays Table:
```{r}
#| echo: false
  
# Weekdays vs Holidays

days_holidays <- as.data.frame.matrix(table(day_of_week, holiday))

reactable(days_holidays, 
          columns = list( 
            .rownames = colDef(name = "Day of the Week"), 
            "0" = colDef(name = "No Holiday"), 
            "1" = colDef(name = "Holiday")),
          sortable = FALSE,
          highlight = TRUE, 
          borderless = TRUE, 
          bordered = TRUE,
          theme = my_theme
          )

```

#### Comments:

### Section 3: Simple Linear Regression

#### Model Fitting:

```{r}
# From first principles (manual calculation), fit a simple linear regression of consumption_kwh on outside_temperature

#1) design matrix

X <- cbind(1, outside_temperature)
Y <- consumption_kwh
k <- ncol(X)
n <- nrow(X)
p <- k-1

#2) finding regression coefficients

B_hat <- solve(t(X)%*%X)%*%t(X)%*%Y
B0_hat <- B_hat[1]
B1_hat <- B_hat[2]


#3) calculating residuals and variance

Y_hat <- X %*% B_hat
e <- Y - Y_hat
SSE <- t(e) %*% e
SST <- sum((Y-mean(Y))^2)
s_squared <- as.numeric(SSE/(n-k))

#4) Calculating Standard Errors
cov_mat_B <- s_squared * solve(t(X)%*%X)
se_B <- sqrt(diag(cov_mat_B))
se_B0 <- se_B[1]
se_B1 <- se_B[2]

#5) t,f & p - values

t_B0 <- B0_hat/se_B0
t_B1 <- B1_hat/se_B1
p_B0 <- 2 * pt(abs(t_B0), df = n - k, lower.tail = FALSE)
p_B1 <- 2 * pt(abs(t_B1), df = n - k, lower.tail = FALSE)
F_stat <- ((SST-RSS)/(k-1)) / s_squared
p_F <- pf(F_stat, df = k - 1, lower.tail = FALSE)

#5) Multiple R squared and R-adjusted
R_squared <- 1 - (SSE/SST)
R_adj <- 1-(1-R_sqaured)*((n-1)/(n-k))


# Reproduce the summary() output, working from the coefficients table down

cat("Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n")
cat("Residual standard error: ", round(s_squared, 2), " on ", n-p, " degrees of freedom")
cat("Multiple R-squared: ",R_squared, "\t Adjusted R-squared: ",R_adj )
cat("F-statistic: ")
```

#### Simultaneous Hypothesis Test:

```{r}

```

### Section 4: Multiple Linear Regression

#### Fit Model:

```{r}

```

#### Hypothesis Testing:

```{r}

```

#### Interpretation:

```{r}

```

### Section 5: Conclusion

#### Summary:

```{r}

```

#### Recomendations:

```{r}

```

#### Future Research:

```{r}

```


---

## Part Two: Simulation of Power



### Scenario A: Baseline Normal Errors

```{r}

```

### Scenario B: Non-linear Truth/Exponential Relationship

```{r}

```
