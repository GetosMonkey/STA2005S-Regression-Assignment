---
title: "Stats Assignment 1"
author: "Group 48 - ABRMAR043"
format:
  html:
    toc: true
    toc-location: right
    number-sections: true
    self-contained: true
editor: visual
---

# STA2005S Regression Assignment

Setup, Data loading and Objective:

```{r, echo=TRUE, eval=TRUE, include=FALSE}
# We want to analyse the relationships between the variables: (outside_temperature, humidity, wind_speed, household_size, appliance_index, energy_efficiency, solar_installed, day_of_week, and holiday) against consumption_kwh to inform demand-side management and efficiency policy

#| results: hide
#| warning: false
#| message: false
#| error: false
if (!requireNamespace("remotes", quietly = TRUE)) {
install.packages("remotes")
}
remotes::install_github("MiguelRodo/DataTidyRodoSTA2005S")
data("data_tidy_energy_use", package = "DataTidyRodoSTA2005S")

```

```{r}
#| results: hide
#| warning: false
#| echo: false

library(ggplot2)
library(dplyr)
library(tidyr)
library(car)
library(MASS)
library(reshape2)
library(reactable)
library(shiny)
library(knitr)
library(gganimate)
library(gifski)

data <- data_tidy_energy_use

consumption_kwh <- data$consumption_kwh
outside_temperature <- data$outside_temperature
humidity <- data$humidity
wind_speed <- data$wind_speed
household_size <- data$household_size
appliance_index <- data$appliance_index

energy_efficiency <- factor(data$energy_efficiency, levels = c("Poor", "Average", "Good", "Excellent"), ordered = TRUE)

solar_installed <- factor(data$solar_installed, levels = c("Yes", "No"), ordered = TRUE)

day_of_week <- factor(data$day_of_week, 
levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"), ordered = TRUE)

holiday <- data$holiday

# Making a color Palette for my document: 
col_palette = c (
  "#ff6fae",
  "#d81159",
  "#f94144", 
  "#f3722c", 
  "#f8961e", 
  "#f9c74f",
  "#90be6d", 
  "#43aa8b",
  "#4d908e",
  "#277da1",
  "#3a86ff",
  "#7766EB",
  "#9d4edd",
  "#991090", 
  "#c93399"
  
)

```

------------------------------------------------------------------------

## Part One: Analysis

### Section 1: Introduction

#### Problem & Unknown:

The problem being addressed is understanding what factors most influence daily household electricity consumption (kWh) in Cape Town, so that with the insights gained we can better support demand management, tariff design, and energy-efficiency interventions.

The unknown factors under investigation are: environmental conditions ( outside temperature, humidity, and wind speed), household characteristics (household size, appliance type, efficiency rating, and solar installation status), and time factors(day of the week and holiday status).

#### Analysis Summary:

Our analytical approach consists of thorough data exploration and visualization using a variety of inferential techniques namely:

1)  Visualizations with density plots, pairwise plots, and categorical plots; to get a holistic understanding of all factors on electricity consumption.
2)  Simple linear regression, to test the effect of outside temperature on electricity consumption
3)  Single variable hypothesis testing, to test the effect of energy efficiency on electricity consumption
4)  Multiple linear regression and Analysis of variance (ANOVA), to model the complex relationships between all predictor variables and electricity consumption

We expect household characteristic predictor variables such as household size, energy efficiency rating and solar installation status to be the strongest predictors of household electricity consumption, and for environmental and time factors to be comparatively weak predictors.

#### Nature of analysis:

The primary goal of the analysis is explanatory as we seek to understand and explain the relationships between the various factors and electricity consumption to inform later decision making, rather than to build a predictive model for future consumption.

### Section 2: Data Exploration

#### Density Plots:

```{r}
# Plot a histogram of consumption_kwh (freq = FALSE, if using base R) with an overlaid normal density 

mean_kwh <- mean(consumption_kwh, na.rm = TRUE)
sd_kwh <- sd(consumption_kwh, na.rm = TRUE)

hist(consumption_kwh, 
     freq = FALSE, 
     main = "Histogram of Electricity Consumption", 
     xlab = "Consumption (kwh)",
     ylab = "Density",
     col = col_palette[7], 
     border = "white"
     )

curve(dnorm(x, mean = mean_kwh, sd = sd_kwh), 
      col = col_palette[11], 
      lwd = 2.5, 
      add = TRUE
      )

```

###### Shape:

The underlying distribution of consumption (kWh) is bimodal with two clear peaks around 7 and 22 kWh. It is fairly symmetric about these two peaks and does not display a wide spread/range. Because of the bimodality, the overlaid normal density does not align well with the data implying that the underlying overall distribution is not normal.

```{r}
#| warning: false
# Plot the density of consumption_kwh, stratified by solar_installed, with overlaid normal densities. Comment on the shape, and consider why the densities changes from the unstratified case.

solar_yes <- data %>% filter(solar_installed == "Yes")
solar_no <- data %>% filter(solar_installed == "No")

mean_solar <- mean(solar_yes$consumption_kwh, na.rm = TRUE)
mean_no_solar <- mean(solar_no$consumption_kwh, na.rm = TRUE)
sd_solar <- sd(solar_yes$consumption_kwh, na.rm = TRUE)
sd_no_solar <- sd(solar_no$consumption_kwh, na.rm = TRUE)

ggplot(data, aes(x = consumption_kwh, fill = solar_installed)) +
  geom_density(color = "white", linewidth = 0, alpha = 0.4) +

  stat_function(fun = dnorm, 
                args = list(mean = mean_solar, sd = sd_solar),
                aes(linetype = "Normal (Solar)"),
                color = col_palette[4], linewidth = 1.15) +
  stat_function(fun = dnorm, 
                args = list(mean = mean_no_solar, sd = sd_no_solar),
                aes(linetype = "Normal (No solar)"),
                color = col_palette[12], linewidth = 1.15) +
  
  scale_fill_manual(values= c("Yes"=col_palette[1], "No"=col_palette[11])) +
  scale_linetype_manual(values = c(2, 2), name = "Normal Distribution") +
  
  labs(title = "Density Plot of Electricity Consumption Density by Solar Installation", 
       x = "Consumption (kWh)", 
       y = "Density",
       fill = "Solar Installed"
       ) +
  theme_minimal()
  
```

###### Shape:

When stratified by solar installation status, the electricity consumption distributions for households with and without solar installed closely match their respective overlaid normal densities. This implies that within these groups the observations are approximately normally distributed and reinforces the bimodality we found in the unstratified case.This implies that solar installation status has a major influence on household electricity consumption.

#### Pairwise Plots:

```{r}
#| fig-width: 22
#| fig-height: 18
#| out-width: "100%"
#| layout-ncol: 1
#| dpi: 150

# Create pairwise scatterplots for all continuous variables, including consumption_kwh

cts_variables <- data %>%
  dplyr::select(consumption_kwh, outside_temperature, humidity, 
                wind_speed, household_size, appliance_index)

day_numeric <- as.numeric(factor(data$day_of_week, 
levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"), ordered = TRUE))

efficiency_numeric <- as.numeric(factor(data$energy_efficiency, levels = c("Poor", "Average", "Good", "Excellent"), ordered = TRUE))

solar_numeric <- as.numeric(factor(data$solar_installed, levels = c("Yes", "No"), ordered = TRUE))
#_________________________________________________________________

# Graph
pairs(x = cts_variables, pch = 19, 
      col = col_palette[efficiency_numeric + 1], 
      main = " Pairwise Scatterplot for Continous Variables", 
      gap = 0.5,
      las = 1, 
      cex = 3, 
      cex.labels = 3, 
      cex.axis = 3,
      cex.main = 3
      )
```

#### Categorical Variable Plots:

```{r}
#| fig-align: "center"
#| echo: FALSE

# Plot consumption_kwh against each categorical variable. Namely: Solar_installed, Energy_efficient, days_of_the_week, and holiday

par(mar = c(4, 10, 3, 2))
boxplot(consumption_kwh ~ efficiency_numeric, data = data,
        horizontal = TRUE, 
        names = levels(energy_efficiency),
        xlab = "Energy Consumption (kWh)", ylab = "", 
        main = "Boxplot of Energy Consumption \nby Efficiency",
        col = col_palette[1:4], 
        las = 1
        )
mtext("Efficiency", side = 2, line = 6, cex = 1, font = 1)

par(mar = c(4, 10, 3, 2))
boxplot(consumption_kwh ~ solar_numeric, data = data, 
        horizontal = TRUE,
        names = levels(solar_installed),
        xlab = "Energy Consumption (kWh)", ylab = "Solar Installed", 
        main = "Boxplot of Energy Consumption \nby Solar Use",
        col = col_palette[5:6], 
        las = 1
        )

par(mar = c(4, 10, 3, 2))
boxplot(consumption_kwh ~ day_numeric, data = data, 
        horizontal = TRUE,
        names = levels(day_of_week),
        xlab = "Energy Consumption (kWh)", ylab = "", 
        main = "Boxplot of Energy Consumption \nby Weekday",
        col = col_palette[7:13], 
        las = 1
        )
mtext("Weekday", side = 2, line = 6, cex = 1, font = 1)

par(mar = c(4, 10, 3, 2))
boxplot(consumption_kwh ~ holiday, data = data, 
        horizontal = TRUE,
        names = c("No", "Yes"),
        xlab = "Energy Consumption (kWh)", ylab = "Holiday", 
        main = "Boxplot of Energy Consumption \nby Holiday Status",
        col = col_palette[14:15], 
        las = 1
        )

```

#### Categorical Relationships:

###### Energy Efficiency vs Solar Usage Table:

```{r}
#| echo: false

my_theme <- reactableTheme(
            highlightColor = col_palette[1],
            headerStyle = list(
              background = col_palette[11],
              color = "white",
              fontSize = "14px",
              fontWeight = "bold",
              borderBottom = paste0("2px solid ",col_palette[4])
            )
            )
  
# Efficiency vs Solar Usage

efficiency_solar <- as.data.frame.matrix(table(energy_efficiency, solar_installed))

reactable(efficiency_solar, 
          columns = list( .rownames = colDef(name = "Energy Efficiency"), No = colDef(name = "No Solar"), Yes = colDef(name = "Solar use")),
          sortable = FALSE,
          highlight = TRUE, 
          borderless = TRUE, 
          bordered = TRUE,
          theme = my_theme
          )

```

<br>

###### Weekdays vs Holidays Table:

```{r}
#| echo: false
  
# Weekdays vs Holidays

days_holidays <- as.data.frame.matrix(table(day_of_week, holiday))

reactable(days_holidays, 
          columns = list( 
            .rownames = colDef(name = "Day of the Week"), 
            "0" = colDef(name = "No Holiday"), 
            "1" = colDef(name = "Holiday")),
          sortable = FALSE,
          highlight = TRUE, 
          borderless = TRUE, 
          bordered = TRUE,
          theme = my_theme
          )

```

#### Comments:

**Observed Relationships:**

-   From our density plots their is a clear difference in electricity consumption distributions between households with solar installation and without. This is the most prominent relationship - households with solar installed show lower average electricity consumption than households without.

-   From our Pairwise scatterplot there is a positive linear relationship between household size and electricity consumption, stratified by household use of solar power as seen below:

::: {#fig-scatterplot .figure}
![](scatterplot.png){width="150px"}

Scatterplot of Electricity Consumption by Household Size
:::

-   From our boxplots the mean consumption of electricity on a weekday is lower than the mean consumption of electricity during the weekend.

-   From our boxplots, energy efficiency ratings have little effect on mean household electricity consumption unless the efficiency rating is "Poor". Poorly rated households experience higher average electricity consumption.

-   From our pairwise scatterplots there appears to be very weak relationships between environmental factors and household electricity consumption.

**Potential Collinearity:**

From our pairwise scatterplot we can see that their is potential collinearity between the environmental factors since there appears to be a positive linear relationship between temperature-and-humidity as well as humidity-and-windspeed. This is to be expected as weather conditions often co-vary.

From our tables there appears to be potential collinearity between energy efficiency and solar installation, with poor efficiency being associated with no solar usage, but not majorly so as other ranks of efficiency show no clear relationship with solar usage.

**Outliers:**

There are no outlying observations of note.

### Section 3: Simple Linear Regression

#### Model Fitting:

```{r}
# From first principles (manual calculation), fit a simple linear regression of consumption_kwh on outside_temperature

#1) design matrix

X <- cbind(1, outside_temperature)
Y <- consumption_kwh
k <- ncol(X)
n <- nrow(X)
p <- k-1

#2) finding regression coefficients

B_hat <- solve(t(X)%*%X)%*%t(X)%*%Y
B0_hat <- B_hat[1]
B1_hat <- B_hat[2]

#3) calculating residuals and variance

Y_hat <- X %*% B_hat
e <- Y - Y_hat
SSE <- t(e) %*% e
SST <- sum((Y-mean(Y))^2)
s_squared <- as.numeric(SSE/(n-k))

#4) calculating Standard Errors

cov_mat_B <- s_squared * solve(t(X)%*%X)
se_B <- sqrt(diag(cov_mat_B))
se_B0 <- se_B[1]
se_B1 <- se_B[2]

#5) t,f & p - values

t_B0 <- B0_hat/se_B0
t_B1 <- B1_hat/se_B1
p_B0 <- 2 * pt(abs(t_B0), df = n - k, lower.tail = FALSE)
p_B1 <- 2 * pt(abs(t_B1), df = n - k, lower.tail = FALSE)
F_stat <- ((SST-SSE)/(k-1)) / s_squared
p_F <- pf(F_stat, df1 = k - 1, df2 = n - k, lower.tail = FALSE)

#5) multiple R squared and R-adjusted

R_squared <- 1 - (SSE/SST)
R_adj <- 1-(1-R_squared)*((n-1)/(n-k))

```

------------------------------------------------------------------------

```{r}
#| echo: FALSE

# Reproduce the summary() output, working from the coefficients table down

stars = character(2)
for (i in 1:2){
  p_value = c(p_B0, p_B1)[i]
  if (i<0.001){ stars[i] = "***" } 
  else if (i < 0.01){ stars[p_value] = '**' }
  else if (i < 0.05){ stars[p_value] = '*' }
  else if (i < 0.1) { stars[p_value] = "."}
}
  
coeff_table <- data.frame(
                estimates = c(B0_hat, B1_hat),
                std_errors = c(se_B0, se_B1),
                t_values = c(t_B0, t_B1),
                p_values =c(p_B0, p_B1),
                signif = stars
                  )
rownames(coeff_table) <- c("(Intercept)", "X1")

cat("\nCoefficients:")

print(coeff_table)

cat("\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n")
cat("Residual standard error: ", round(sqrt(s_squared), 2), "on", n-p, "degrees of freedom.\n")
cat("Multiple R-squared: ",round(R_squared, 4), "\tAdjusted R-squared: ",round(R_adj, 4), "\n" )
cat("F-statistic: ", round(F_stat, 2), "on", k-1, "and", n-k, "DF, p-value: ", round(p_F, 4), "\n")
```

------------------------------------------------------------------------

#### Simultaneous Hypothesis Test:

```{r}
# From first principles, perform a simultaneous hypothesis test for the effect of energy_efficiency on consumption_kwh.

#1) design matrix and variables

Average <- as.numeric(energy_efficiency == "Average")
Good <- as.numeric(energy_efficiency == "Good")
Excellent <- as.numeric(energy_efficiency == "Excellent")

X_eff <- cbind(1, Average, Good, Excellent)
colnames(X_eff) <- c("Intercept", "$\\beta_{Average}$", "$\\beta_{Good}$", "$\\beta_{Excellent}$")
#Y is the same
n_eff <- nrow(X_eff)
k_eff <- ncol(X_eff)

#2) finding regression coefficients

B_hat_eff <- solve(t(X_eff)%*%X_eff)%*%t(X_eff)%*%Y

#3) calculating residuals and variance

Y_hat_eff <- X_eff %*% B_hat_eff
e_eff <- Y - Y_hat_eff
SSE_eff <- t(e_eff) %*% e_eff
SST_eff <- sum((Y-mean(Y))^2)
s_squared_eff <- as.numeric(SSE_eff/(n-k))
vcov_B_eff <- s_squared_eff * solve(t(X_eff)%*%X_eff)
names(B_hat_eff) <- colnames(X_eff)

#4) L matrix for Hypothesis test: H0 = B_average = B_good = B_excellent

L <- matrix(c(0, 1, 0, 0, 
              0, 0, 1, 0, 
              0, 0, 0, 1), 
            nrow = 3, byrow = TRUE)
colnames(L) <- names(B_hat_eff)

#5) contrasts

contrast <- L %*% B_hat_eff
vcov_contrast <- L %*% vcov_B_eff %*% t(L)

#5) F statistic and p-value

F_stat_eff <- t(contrast) %*% solve(vcov_contrast) %*% contrast / nrow(L)
F_stat_eff <- as.numeric(F_stat_eff)

p_value_F <- pf(F_stat_eff, df1 = nrow(L), df2 = n_eff - k_eff, lower.tail = FALSE)
                                                         
```

------------------------------------------------------------------------

```{r, results = "asis"}
#| echo: FALSE
# Output

cat("Null Hypothesis: ")
cat("$$H_{0}: \\beta_{Poor} = \\beta_{Average} = \\beta_{Good} = \\beta_{Excellent} = 0$$\n\n")

cat("Alternative Hypothesis: ")
cat("$$H_{1}: \\text{At least one of } (\\beta_{Poor}, \\beta_{Average}, \\beta_{Good}, \\beta_{Excellent}) \\neq 0$$\n")

cat("Test-statistic: ")
cat("$$F_{stat} = ", round(F_stat_eff, 3), "$$\n")

cat("p-value: ")
cat("$$p_{value} = ", round(p_value_F, 4), " > 0.05 $$\n")

cat("Conclusion: ")
cat("$$\\text{At the } \\alpha = 0.05 \\text{ significance level, we fail to reject } H_{0}.$$")
cat("$$\\text{Because there is no significant overall effect of energy efficiency} $$")
cat("$$\\text{on energy consumption } (p_{value} > 0.05).$$\n")

```

------------------------------------------------------------------------

### Section 4: Multiple Linear Regression

#### Fit Model:

```{r}
# Fit a multiple linear regression including all explanatory variables. Include an interaction term between outside_temperature and humidity.

fit <- lm(consumption_kwh ~ 
            outside_temperature + 
            humidity + wind_speed + 
            household_size + 
            appliance_index + 
            energy_efficiency + 
            solar_installed + 
            day_of_week + holiday +
            outside_temperature:humidity, 
            data = data)

# Construct and display a table of coefficients with 95% confidence intervals and p-values.

confint_fit <- confint(fit, level = 0.95)

fit_summary <- summary(fit)
table_coefficients <- fit_summary$coefficients

table_final <- cbind(table_coefficients[,
               c( "Pr(>|t|)")], confint_fit)
colnames(table_final) <- c( "p-value", "CI:97.5%", "CI:2.5%")

cat("\nRegression Coefficients with 95% Confidence Intervals and p-values\n")
print(table_final, digits = 3)

```

#### Hypothesis Testing:

```{r}
#| results: hide

# Test whether the following significantly affect consumption_kwh

# Outside Temperature
fit_no_temp <- lm(consumption_kwh ~ 
                   humidity + 
                   wind_speed + 
                   household_size + 
                   appliance_index + 
                   energy_efficiency + 
                   solar_installed + 
                   day_of_week + holiday,
                   data = data)

anova_temp <- anova(fit_no_temp, fit)
print(anova_temp)
cat("\n\n")

# Humidity 

fit_no_humidity <- lm(consumption_kwh ~ 
            outside_temperature + 
            wind_speed + 
            household_size + 
            appliance_index + 
            energy_efficiency + 
            solar_installed + 
            day_of_week + holiday,
            data = data)

anova_humidity <- anova(fit_no_humidity, fit)
print(anova_humidity)
cat("\n\n")

# Solar Installed

fit_no_solar <- lm(consumption_kwh ~ 
            outside_temperature +
            energy_efficiency +
            humidity + 
            wind_speed + 
            household_size + 
            appliance_index +
            day_of_week + holiday,
            data = data)

anova_solar <- anova(fit_no_solar, fit)
print(anova_solar)
cat("\n\n")

# day of the week

fit_no_day <- lm(consumption_kwh ~ 
            outside_temperature +
            energy_efficiency +
            solar_installed +
            humidity + 
            wind_speed + 
            household_size + 
            appliance_index +
            holiday,
            data = data)

anova_day <- anova(fit_no_day, fit)
print(anova_day)
cat("\n\n")

```

------------------------------------------------------------------------

```{r, results= 'asis'}
#| echo: FALSE 

# Displaying results: Outside Temperature
cat("Hypothesis test: Effect of Outside Temperature")

cat("$$H_{0}: \\beta_{temperature} = \\beta_{temp:humidity} = 0$$\n\n")

cat("$$H_{1}: \\text{At least one of } (\\beta_{temperature}, \\beta_{temp:humidity}) \\neq 0$$\n")

cat("$$F_{stat} = ", round(anova_temp$F[2], 3), "$$\n")

cat("$$p_{value} = ", round(anova_temp$`Pr(>F)`[2], 4), " > 0.05 $$\n")

cat("$$\\text{At the } \\alpha = 0.05 \\text{ significance level, we fail to reject } H_{0}.$$")
cat("$$\\text{Because there is no significant overall effect of outside temperature} $$")
cat("$$\\text{on energy consumption } (p_{value} > 0.05).$$\n")

cat("------------------------------------------------------------------------————————————————\n")

# Displaying results: Humidity
cat("\nHypothesis test: Effect of Humidity")

cat("$$H_{0}: \\beta_{humidity} = \\beta_{temp:humidity} = 0$$\n\n")

cat("$$H_{1}: \\text{At least one of } (\\beta_{humidity}, \\beta_{temp:humidity}) \\neq 0$$\n")

cat("$$F_{stat} = ", round(anova_humidity$F[2], 3), "$$\n")

cat("$$p_{value} = ", round(anova_humidity$`Pr(>F)`[2], 4), " > 0.05 $$\n")

cat("$$\\text{At the } \\alpha = 0.05 \\text{ significance level, we fail to reject } H_{0}.$$")
cat("$$\\text{Because there is no significant overall effect of humidity} $$")
cat("$$\\text{on energy consumption } (p_{value} > 0.05).$$\n")

cat("------------------------------------------------------------------------————————————————\n")

# Displaying results: Solar Installed
cat("\nHypothesis test: Effect of Solar Usage")

cat("$$H_{0}: \\beta_{solar} = \\beta_{no solar} = 0$$\n\n")

cat("$$H_{1}: \\text{At least one of } (\\beta_{solar}, \\beta_{no solar}) \\neq 0$$\n")

cat("$$F_{stat} = ", round(anova_solar$F[2], 3), "$$\n")

cat("$$p_{value} = ", anova_solar$`Pr(>F)`[2], " < 0.05 $$\n")

cat("$$\\text{At the } \\alpha = 0.05 \\text{ significance level, we reject } H_{0} \\text{ in favor of } H_{1}.$$")
cat("$$\\text{Because there is a significant overall effect of solar usage} $$")
cat("$$\\text{on energy consumption } (p_{value} < 0.05).$$\n")

cat("------------------------------------------------------------------------————————————————\n")

# Displaying results: Day of the Week
cat("\nHypothesis test: Effect of Day of the Week")

cat("$$H_{0}: \\beta_{Mon} = \\beta_{Tue} = \\beta_{Wed} = \\beta_{Thu} = \\beta_{Fri} = \\beta_{Sat} = \\beta_{Sun} = 0$$\n\n")

cat("$$H_{1}: \\text{At least one of } (\\beta_{Mon}, \\beta_{Tue}, \\beta_{Wed}, \\beta_{Thu}, \\beta_{Fri}, \\beta_{Sat}, \\beta_{Sun}) \\neq 0$$\n")

cat("$$F_{stat} = ", round(anova_day$F[2], 3), "$$\n")

cat("$$p_{value} = ", anova_day$`Pr(>F)`[2], " > 0.05 $$\n")

cat("$$\\text{At the } \\alpha = 0.05 \\text{ significance level, we fail to reject } H_{0}.$$")
cat("$$\\text{Because there is no significant overall effect of the day of the week} $$")
cat("$$\\text{on energy consumption } (p_{value} > 0.05).$$\n")

```

------------------------------------------------------------------------

#### Interpretation:

At the $\alpha = 0.05$ significance level:

**confidence intervals & Effect Sizes:**

Predictor variables associated with effect estimates, $\hat{\beta_{i}}$, whose confidence intervals contain 0 are considered statistically insignificant, and do not heavily influence household electricity consumption. These factors include (outside_temperature, humidity, wind_speed, appliance_index, energy_efficiency (all levels), days of the week (other than Monday and Saturday), and holidays )

None of the CI's associated with the following factors include 0:

1)  household size: \[0.72, 1.34\] $\implies$ household size has a statistically significant influence on electricity consumption. This positive effect however is fairly weak since it can maximally show a 1.34 units increase in consumption (kWh) per unit increase in household size.
2)  solar installed (yes): \[-14.63, -12.85\] $\implies$ solar usage has a very statistically significant influence on electricity consumption. This negative effect however is very strong since it can maximally show a 14.63 units decrease in consumption (kWh) from having solar power installed compared to not.
3)  Monday: \[0.54, 3.68\] $\implies$ Mondays have a statistically significant influence on electricity consumption. This positive effect however is fairly weak, but less week than household size, since it can maximally show a 3.68 units increase in consumption (kWh) per level change to Monday.
4)  Saturday: \[0.02, 3.95\] $\implies$ Saturdays have a statistically significant influence on electricity consumption.This positive effect however is fairly weak, but less week than household size, since it can maximally show a 3.95 units increase in consumption (kWh) per level change to Saturday.

**P-value:**

All the factors that our confidence intervals found to be statistically insignificant are reinforced as statistically insignificant by their p-values as: $p_{i} > 0.05$, $\forall i \in$ (outside_temperature, humidity, wind_speed, appliance_index, energy_efficiency (all levels), days of the week (other than Monday and Saturday), and holidays)

1)  household size: $p \approx 0 < 0.05 \implies$ household size has a statistically significant influence on electricity consumption
2)  solar installed (yes): $p \approx 0 < 0.05 \implies$ solar usage has a very statistically significant influence on electricity consumption
3)  Monday: $p \approx 0.009 < 0.05 \implies$ Mondays have a statistically significant influence on electricity consumption. This is likely due to the fact that so many holidays fell on a Monday, despite holiday status being statistically insignificant otherwise.
4)  Saturday: $p \approx 0.047 < 0.05 \implies$ Saturdays have a statistically significant influence on electricity consumption

**NB:** Our overall test for the effect of day_of_week concluded that they day of the week was statistically insignificant so the outlying effects of Monday and Saturday should be interpreted with caution.

### Section 5: Conclusion

#### Summary:

The multiple regression analysis finds that household electricity consumption is primarily driven by household characteristics rather than environmental influences or time factors as hypothesized. Surprisingly however, solar installation emerges as the most dominant predictor variable of household electricity consumption by far, whilst the effects of energy efficiency are statistically insignificant and the influence of household size is minimal.

Solar installation reduces daily household electricity consumption by $\approx 13.74$ kWh compared to non-solar homes. Considering that the mean electricity consumption of non-solar homes $\approx 22$ kWh (from our previous density plots) this implies a $\approx 60$ decrease in electricity usage for homes with solar installed.

Household size shows an expected positive relationship with each additional resident on average contributing to a $\approx 1.03$ kWh increase in household electricity consumption. Despite evidence of specific days influencing electricity consumption, the effects are not significant overall, suggesting consistent consumption patterns throughout the week otherwise.

Outside temperature, humidity, wind speed, appliance index, energy efficiency (all levels), and holidays have a statistically insignificant effect on consumption.

#### Recommendations:

For demand-side management and efficiency policy we recommend:

**1) Prioritizing solar installation:** Solar installation and usage is by far the most deterministic predictor of electricity consumption and prioritizing it's widespread use is vital to lowering the average household electrical consumption and expenditure in Cape Town. This could include investing into reusable energy research and development or enforcing solar usage mandates particularly for larger households which can afford to do so. Incentives such as lower rates or benefits could also be offered to promote the use of solar power and solar installation.

**2) Rehashing the energy efficiency rating system:** Unexpectedly, the energy efficiency rating of a household had no statistically significant effect on the household's actual electricity consumption. This suggests that the current efficiency rating systems do not correlate to real-world usage patterns and should be revisited and updated to better reflect consumption.

#### Future Research:

Future studies should investigate socioeconomic factors influencing energy consumption, as solar installation is costly and the effect of solar power on electricity consumption may in reality reflect an underlying wealth disparity, especially in South Africa where inequality is ingrained.

It is also worthwhile investigating the comparative effects of other renewable energy technologies against household electricity consumption patterns alongside solar technology (eg: wind, or battery power). Additionally research should be done on optimal solar configurations for different house types and areas so that we can optimize the integration of solar power into our households.

------------------------------------------------------------------------

## Part Two: Simulation of Power

```{r}
#| echo: FALSE

#setup

B0_sim <- 12
sigma_sq <- 6.25
sd_sim <- sqrt(sigma_sq)
n_sim <- 1000

```

### Scenario A: Baseline Normal Errors

```{r}

set.seed(25)
x_vec_A <- runif(25, 0, 1)
B1_sim_A <- c(0.5, 1, 2, 5, 10)

results_A <- data.frame(
              B1_A = B1_sim_A, 
              power = numeric(length(B1_sim_A))
              )

for ( i in seq_along(B1_sim_A)){
  
      B1_A <- B1_sim_A[i]
      rejections_A = 0
      
      for (sim in 1:n_sim){
        
        E_A <- rnorm(length(x_vec_A), mean = 0, sd = sd_sim)
        Y_A <- B0_sim + B1_A * x_vec_A + E_A
        
        fit_A <- lm(Y_A ~ x_vec_A)
        p_val_A <- summary(fit_A)$coefficients[2, 4]
        
        if (p_val_A < 0.05){ rejections_A = rejections_A +1 }
        
      }
      results_A$power[i] <- rejections_A/n_sim
      } 
```

```{r, results='asis'}
#| echo: false

#Tabulate results: 
cat("\nTabulated Results of Estimated power across Effect sizes\n")

kable(
  results_A, 
  col.names = c("$\\beta1_{A}$", "power")
  )

```

##### Comments:

From the tabulated results there is a clear monotonic, increasing relationship between the effect size ($\beta1_{A}$) and estimated statistical power (the probability of correctly rejecting a false null hypothesis, $1-\beta$).

**Notably:**

1)  There is a low estimated statistical power at small effect sizes. At $\beta_{1}$ = 0.5, the estimated power is incredibly small at 4.5% which indicates a very high risk of a Type 2 error when test for small effect sizes.

2)  There is a high estimated statistical power at large effect sizes.At $\beta_{1}$ = 5, the estimated power of the test is 77.7% and reaches 100% at $\beta_{1}$ = 10, indicating a very low risk of a Type 2 error when testing for large effect sizes

3)  Changes in the generative seed used changes the power results but not the overall observed trend.

------------------------------------------------------------------------

### Scenario B: Non-linear Truth/Exponential Relationship

```{r}

sample_sizes <- c(5, 10, 20, 50)
B1_B <- 0.01

results_B <- data.frame(
              n_B = rep(sample_sizes, each = 2),
              model = rep(c("Linear", "Exponential"), times = length(sample_sizes)),
              power = numeric(length(sample_sizes)*2)
              )

set.seed(25)
row_index <- 1

for (size in seq_along(sample_sizes)){
    
    n_current = sample_sizes[size]
    
    x_vec_B <- seq(0, 7, length.out = n_current)
    rejections_linear = 0
    rejections_exp = 0
    
    for (sim in 1: n_sim){
      
        E_B <- rnorm(n_current, mean = 0, sd = sd_sim)
        Y_B <- B0_sim + B1_B * exp(x_vec_B) + E_B
        
        fit_linear <- lm(Y_B ~ x_vec_B)
        p_val_linear <- summary(fit_linear)$coefficients[2, 4]
        
        fit_exp <- lm(Y_B ~ exp(x_vec_B))
        p_val_exp <- summary(fit_exp)$coefficients[2, 4]
        
        if (p_val_linear < 0.05){ rejections_linear = rejections_linear +1 }
        if (p_val_exp < 0.05){ rejections_exp = rejections_exp +1 }
    }
    results_B$power[row_index] <- rejections_linear/n_sim
    results_B$power[row_index+1] <- rejections_exp/n_sim
    row_index = row_index + 2
    }

```

```{r}
#| echo: false
#| warning: false

# Table results
cat("\nTabulated Results of Estimated power across Sample size \n")
print(results_B)

# Base graph
graph1 <- 
  ggplot(results_B, aes(x = n_B, y = power, color = model, linetype = model)) +
  geom_line(linewidth = 1.4) +
  geom_point(size = 2) +
  
  scale_color_manual(values = c("Linear" = col_palette[6], "Exponential" = col_palette[13])) +
  scale_linetype_manual(values = c("Linear" = 2, "Exponential" = 1)) +
  
  labs(title = "Line Graph of Statistical Power: Linear vs Exponential Models",
       x = "Sample Size (n)",
       y = "Statistical Power",
       color = "Model Type", 
       linetype = "Model Type"
       ) +
  theme_minimal() +
  scale_y_continuous(limits = c(0,1), breaks = seq(0,1,0.2))
  

graph1_animation <- 
  graph1 + 
  transition_reveal(n_B)
  
animate(graph1_animation)
graph1

```

##### Comments:

From the graphs and the tabulated results there is a clear monotonic increasing relationship between the sample size $n$ and the estimated statistical power ($1- \beta$). The concave downwards curve of the graph shows underlying logarithmic growth, tending towards an asymptote of $\beta = 1$. This is true for both the linear and exponential model.

**Notably:**

1)  The exponential model produces consistently better (higher) estimated statistical power than the linear model, irrespective of $n$. This is because the linear model is mis-specified whilst the exponential model is a correct/ accurate representation of the effective of $n$ on estimated statistical power. This difference is clearest for small $n$.

2)  There is a low estimated statistical power for small $n$. At $n$ = 5, the estimated power is very small at 17.4% for the linear model and moderate at 69.8% for the exponential model. This indicates a moderate to high risk of a Type 2 error when test for small $n$.

3)  There is a high estimated statistical power at for large $n$. At $n$ = 20, the estimated power of the test is very high at 90.1% for the linear model and 99.5% for the exponential model, reaching 100% at $n$ = 50 for both models. This indicates an incredibly low risk of a Type 2 error when testing for large $n$.

------------------------------------------------------------------------

### Conclusion & design insight:

**In Scenario A:**

Estimated power increases as effect size increases for a fixed sample size, $n = 25$. This means there is a clear monotonic, increasing relationship between the effect size ($\beta1_{A}$) and estimated statistical power. From the results of scenario B, this sample size $n = 25$ is sufficiently large for us to ignore the effects of sample size on estimated power (At $n$ = 20: $(1-\beta)_{linear}$ = 90.1%, $(1-\beta)_{exponential}$ = 99.5% ). This implies that effect size is very influential on the power of a test.

**In Scenario B:**

Estimated power increases as sample size increases in both linear an exponential models for a fixed effect size, $\beta_{1} = 0.01$. This means there is a clear monotonic increasing relationship between the sample size $n$ and the estimated statistical power, but since effect size is fixed we can't evaluate its influence in this scenario. Both the mis-specified linear model and exponential model follow a concave growth pattern reaching $(1-\beta) = 1$ however the exponential model consistently outperforms the linear model for all $n$.

**Lowest power yield:**

Scenario A yields the lowest overall power, specifically for small effect sizes ($\beta_{1}$ = 0.5 $\implies (1-\beta)$ = 4.5%).

This is because with a fixed moderate sample size $n$ = 25, very small effect sizes are difficult to detect resulting in a low estimated power and high risk of Type 2 errors in testing.In contrast, Scenario B can achieve higher power by increasing $n$, even for small effect sizes on top of considering the differences between the linear and exponential models (At $n$ = 5 and $\beta_{1} = 0.01$ : $(1-\beta)_{linear}$ = 17.4%, $(1-\beta)_{exponential}$ = 69.8% .

**Design decisions:**

The simulations usefully demonstrate that estimated power increases with both effect size ($\beta_{1}$) and sample size ($n$). On top of this using the correctly specified model greatly improves the power of our tests. This shows that understanding the underlying relationship between our predictor and response variables is fundamental to upholding linear regression assumptions.

------------------------------------------------------------------------
